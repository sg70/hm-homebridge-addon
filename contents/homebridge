#!/bin/sh
ADDONNAME=homebridge
PREFIX=/usr/local
ADDON_DIR=${PREFIX}/addons/${ADDONNAME}
EXEC=${PREFIX}/bin/hb-service
EXECARGS="--user-storage-path $ADDON_DIR --allow-root run"
PIDFILE=/var/run/hb-service.pid

start() {
    logger -t homebridge -p user.info "start $ADDONNAME"
    # shellcheck disable=SC2086 # word split on spaces wanted for $EXECARGS
	pwd >> /var/log/homebridge.log
    start-stop-daemon --start --oknodo --make-pidfile --background --pidfile "$PIDFILE" --exec "$EXEC" -- $EXECARGS
}

stop() {
    start-stop-daemon --stop --oknodo --retry 5 --pidfile "$PIDFILE"
    logger -t homebridge -p user.info "stopped $ADDONNAME"
}

restart() {
	stop
	sleep 10
	start
}

case "$1" in
	start)
		start
	;;
	stop)
		stop
	;;
	restart|reload)
		restart
	;;
	*)
		echo "Usage: $0 {start|restart|stop}"
		exit 1
esac

exit $?
